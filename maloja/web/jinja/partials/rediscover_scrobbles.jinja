{% import 'snippets/links.jinja' as links %}
{% import 'snippets/entityrow.jinja' as entityrow %}

{% if scrobbles is undefined %}
	{% set scrobbles = dbc.get_rediscover(filterkeys,limitkeys) %}
{% endif %}

{% set firstindex = amountkeys.page * amountkeys.perpage %}
{% set lastindex = firstindex + amountkeys.perpage %}

{% set maxbar = scrobbles[0]['scrobbles'] if scrobbles != [] else 0 %}
<table class='list'>
	{% for e in scrobbles %}
		{% if loop.index0 >= firstindex and loop.index0 < lastindex %}
		<tr>
			<!-- Timestamp -->
			<td class='time'>{{ malojatime.timestamp_desc(e["time"],short=shortTimeDesc) }}</td>
			<!-- scrobbles -->
			<td class="amount">{{ links.link_scrobbles([{'track':e.track,'timerange':limitkeys.timerange}],amount=e['scrobbles']) }}</td>
			<td class="bar">{{ links.link_scrobbles([{'track':e.track,'timerange':limitkeys.timerange}],percent=e['scrobbles']*100/maxbar) }}</td>

			<!-- artist -->
			{{ entityrow.row(e['track']) }}
		</tr>
		{% endif %}
	{% endfor %}
</table>
